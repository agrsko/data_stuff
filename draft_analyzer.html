<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fantasy Football Draft Analyzer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
      color: #111;
    }
    header {
      background: #111;
      color: #fff;
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header a {
      color: #fff;
      text-decoration: none;
      font-size: 0.9rem;
    }
    main {
      max-width: 900px;
      margin: 1.5rem auto 2rem;
      padding: 0 1rem;
      background: #fff;
      border-radius: 6px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
    }
    h1, h2, h3 {
      margin-top: 0;
    }
    section {
      padding: 1.5rem 1.5rem 0;
    }
    section:last-of-type {
      padding-bottom: 1.5rem;
    }
    label {
      display: block;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }
    input, select, button {
      font-family: inherit;
      font-size: 0.95rem;
    }
    input, select {
      padding: 0.25rem 0.4rem;
      margin-top: 0.25rem;
    }
    button {
      margin: 1rem 1.5rem 0;
      padding: 0.4rem 0.8rem;
      border-radius: 4px;
      border: 1px solid #111;
      background: #111;
      color: #fff;
      cursor: pointer;
    }
    button:hover {
      opacity: 0.9;
    }
    .settings-row {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
    }
    .small {
      font-size: 0.85rem;
      color: #555;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      font-size: 0.9rem;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 0.35rem 0.5rem;
      text-align: left;
    }
    th {
      background: #f0f0f0;
    }
    .not-found {
      color: #b00020;
      font-size: 0.8rem;
      margin-left: 4px;
    }
  </style>
</head>
<body>
  <header>
    <div>
      <h1 style="margin:0;font-size:1.3rem;">Fantasy Football Draft Analyzer</h1>
      <p style="margin:0.2rem 0 0;font-size:0.9rem;opacity:0.85;">
        Choose your draft settings, enter your picks, and get grades.
      </p>
    </div>
    <div>
      <a href="index.html">&larr; Back to portfolio</a>
    </div>
  </header>

  <main>
    <!-- Intro -->
    <section>
      <h2>How it works (v1)</h2>
      <p class="small">
        Step 1: Set your draft settings.<br />
        Step 2: Click <strong>Build picks table</strong> to generate one row per round.<br />
        Step 3: Type your players in order (one per round). The tool uses
        your pick slot, draft type, and number of teams to calculate each
        pick&apos;s overall number, then compares each player&apos;s actual season
        to their expected season to assign a grade.
      </p>
    </section>

    <!-- Draft Settings -->
    <section>
      <h3>Draft Settings</h3>
      <div class="settings-row">
        <label>
          Number of teams
          <select id="numTeams">
            <option value="6">6</option>
            <option value="8">8</option>
            <option value="10">10</option>
            <option value="12" selected>12</option>
            <option value="14">14</option>
          </select>
        </label>

        <label>
          Pick Slot
          <input type="number" id="pickSlot" min="1" max="14" value="1" />
        </label>

        <label>
          Number of rounds
          <input type="number" id="numRounds" min="1" max="25" value="16" />
        </label>

        <label>
          Draft type
          <select id="draftType">
            <option value="snake" selected>Snake</option>
            <option value="linear">Non-snake (Linear)</option>
          </select>
        </label>
      </div>
      <p class="small">
        These settings let the tool compute each pick&apos;s round and overall
        draft position, so you only have to type in player names.
      </p>

      <button id="buildPicksBtn">Build picks table</button>
    </section>

    <!-- Picks input -->
    <section>
      <h3>Your picks</h3>
      <p class="small">
        After building the picks table, enter the player you drafted in each
        round. As the player database grows, names will autocomplete while you type.
      </p>
      <div id="picksTableContainer" class="small">
        <p>No picks yet. Choose your settings and click &ldquo;Build picks table.&rdquo;</p>
      </div>
    </section>

    <button id="analyzeBtn">Analyze draft</button>

    <!-- Results -->
    <section>
      <h3>Pick grades</h3>
      <div id="resultsContainer" class="small">
        <p>No results yet.</p>
      </div>
    </section>
  </main>

  <!-- Autocomplete list for players -->
  <datalist id="playersList"></datalist>

  <script>
    // --- Example player database (expand this with your real data) ---
    const players = [
      { name: "Christian McCaffrey", position: "RB", expectedPpr: 320, actualPpr: 350 },
      { name: "CeeDee Lamb", position: "WR", expectedPpr: 290, actualPpr: 330 },
      { name: "Tyreek Hill", position: "WR", expectedPpr: 300, actualPpr: 310 },
      { name: "Jonathan Taylor", position: "RB", expectedPpr: 260, actualPpr: 240 },
      { name: "Brock Bowers", position: "TE", expectedPpr: 200, actualPpr: 230 },
      { name: "Tee Higgins", position: "WR", expectedPpr: 210, actualPpr: 190 },
      { name: "Jaylen Waddle", position: "WR", expectedPpr: 230, actualPpr: 220 }
      // TODO: add the rest of your 202x dataset here
    ];

    function populatePlayerDatalist() {
      const list = document.getElementById("playersList");
      list.innerHTML = players
        .map(p => `<option value="${p.name}"></option>`)
        .join("");
    }

    function findPlayerByName(name) {
      const clean = name.trim().toLowerCase();
      return players.find(p => p.name.toLowerCase() === clean) || null;
    }

    function gradeFromValueScore(v) {
      if (v >= 1.25) return "A+";
      if (v >= 1.15) return "A";
      if (v >= 1.05) return "B";
      if (v >= 0.95) return "C";
      if (v >= 0.85) return "D";
      return "F";
    }

    // Compute pick within round and overall pick
    function computePickInfo(round, numTeams, slot, draftType) {
      let pickInRound;
      if (draftType === "snake") {
        // Odd rounds: normal order; even rounds: reversed
        if (round % 2 === 1) {
          pickInRound = slot;
        } else {
          pickInRound = numTeams - slot + 1;
        }
      } else {
        // Linear (non-snake)
        pickInRound = slot;
      }
      const overall = (round - 1) * numTeams + pickInRound;
      return { pickInRound, overall };
    }

    function buildPicksTable() {
      const numTeams = Number(document.getElementById("numTeams").value);
      const slot = Number(document.getElementById("pickSlot").value);
      const numRounds = Number(document.getElementById("numRounds").value);
      const draftType = document.getElementById("draftType").value;
      const container = document.getElementById("picksTableContainer");

      if (!numTeams || !slot || !numRounds) {
        container.innerHTML = "<p>Please enter valid draft settings first.</p>";
        return;
      }

      let html = "<table>";
      html += "<thead><tr>";
      html += "<th>Round</th><th>Overall pick</th><th>Pick in round</th><th>Player</th>";
      html += "</tr></thead><tbody>";

      for (let r = 1; r <= numRounds; r++) {
        const { pickInRound, overall } = computePickInfo(r, numTeams, slot, draftType);
        html += "<tr>";
        html += `<td>${r}</td>`;
        html += `<td>${overall}</td>`;
        html += `<td>${pickInRound}</td>`;
        html += `<td><input type="text"
                             class="player-input"
                             data-round="${r}"
                             data-overall="${overall}"
                             data-pick-in-round="${pickInRound}"
                             list="playersList"
                             placeholder="Start typing a player name..." /></td>`;
        html += "</tr>";
      }

      html += "</tbody></table>";
      container.innerHTML = html;
    }

    function analyzeDraft() {
      const inputs = document.querySelectorAll(".player-input");
      const resultsContainer = document.getElementById("resultsContainer");

      if (!inputs.length) {
        resultsContainer.innerHTML = "<p>Build the picks table and enter players first.</p>";
        return;
      }

      const rows = [];
      inputs.forEach(input => {
        const playerName = input.value.trim();
        if (!playerName) return; // skip empty rounds

        const round = Number(input.dataset.round);
        const overall = Number(input.dataset.overall);
        const pickInRound = Number(input.dataset["pickInRound"]);

        const player = findPlayerByName(playerName);
        let expected = null;
        let actual = null;
        let valueScore = null;
        let grade = null;

        if (player) {
          expected = player.expectedPpr;
          actual = player.actualPpr;
          if (expected && expected > 0 && actual != null) {
            valueScore = actual / expected;
            grade = gradeFromValueScore(valueScore);
          }
        }

        rows.push({
          round,
          overall,
          pickInRound,
          teamName: "My Team",
          playerName,
          playerFound: !!player,
          expected,
          actual,
          valueScore,
          grade
        });
      });

      if (!rows.length) {
        resultsContainer.innerHTML = "<p>No players entered yet.</p>";
        return;
      }

      // Build results table
      let html = "<table>";
      html += "<thead><tr>";
      html += "<th>Round</th><th>Overall</th><th>Pick in round</th>";
      html += "<th>Player</th><th>Expected PPR</th><th>Actual PPR</th>";
      html += "<th>Value (Actual / Expected)</th><th>Grade</th>";
      html += "</tr></thead><tbody>";

      rows.forEach(r => {
        html += "<tr>";
        html += `<td>${r.round}</td>`;
        html += `<td>${r.overall}</td>`;
        html += `<td>${r.pickInRound}</td>`;
        html += `<td>${r.playerName}${!r.playerFound ? '<span class="not-found"> (not found)</span>' : ""}</td>`;
        html += `<td>${r.expected != null ? r.expected.toFixed(1) : "—"}</td>`;
        html += `<td>${r.actual != null ? r.actual.toFixed(1) : "—"}</td>`;
        html += `<td>${r.valueScore != null ? r.valueScore.toFixed(2) : "—"}</td>`;
        html += `<td>${r.grade || "—"}</td>`;
        html += "</tr>";
      });

      html += "</tbody></table>";
      resultsContainer.innerHTML = html;
    }

    // Wire up buttons and datalist on load
    document.getElementById("buildPicksBtn").addEventListener("click", buildPicksTable);
    document.getElementById("analyzeBtn").addEventListener("click", analyzeDraft);
    populatePlayerDatalist();
  </script>
</body>
</html>
